<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Makale Detayları</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 30px auto;
      padding: 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    .meta {
      color: gray;
      margin-bottom: 20px;
    }
    .basic-info, .inside {
      margin-bottom: 15px;
      white-space: pre-wrap;
    }
    #comments {
      margin-top: 40px;
      border-top: 1px solid #ccc;
      padding-top: 20px;
    }
    #comments h2 {
      margin-bottom: 10px;
    }
    #commentList {
      margin-bottom: 20px;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 10px;
      background: #f9f9f9;
    }
    .comment {
      border-bottom: 1px solid #ddd;
      padding: 8px 0;
    }
    #commentInput {
      width: 100%;
      height: 80px;
      padding: 8px;
      box-sizing: border-box;
      font-size: 1em;
      margin-bottom: 10px;
    }
    #addCommentBtn {
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div id="content">
    <p>Makale yükleniyor...</p>
  </div>

  <div id="comments" style="display:none;">
    <h2>Yorumlar</h2>
    <div id="commentList"></div>
    <textarea id="commentInput" placeholder="Yorumunuzu buraya yazın..."></textarea><br />
    <button id="addCommentBtn">Yorumu Ekle</button>
  </div>

  <script src="datas.js"></script>
  <script>
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    function loadStoredArticles() {
      const stored = localStorage.getItem('addedArticles');
      if (stored) {
        try {
          return JSON.parse(stored);
        } catch {
          return [];
        }
      }
      return [];
    }

    const articlesDataAll = articlesData.concat(loadStoredArticles());
    const articleIndex = getQueryParam('article');
    const contentDiv = document.getElementById('content');

    if(articleIndex === null || isNaN(articleIndex) || articleIndex < 0 || articleIndex >= articlesDataAll.length) {
      contentDiv.innerHTML = '<p>Geçersiz veya eksik makale numarası.</p>';
    } else {
      const article = articlesDataAll[articleIndex];
      contentDiv.innerHTML = `
        <h1>${article.title}</h1>
        <div class="meta">Yazar: ${article.author} — Tarih: ${article.date}</div>
        <div class="basic-info"><strong>Özet:</strong><br>${article.basicInfo.replace(/\n/g, '<br>')}</div>
        <div class="inside"><strong>İçerik:</strong><br>${article.inside.replace(/\n/g, '<br>')}</div>
      `;

      // Show comments section
      const commentsSection = document.getElementById('comments');
      commentsSection.style.display = 'block';

      // Load and display comments
      const commentList = document.getElementById('commentList');
      const commentInput = document.getElementById('commentInput');
      const addCommentBtn = document.getElementById('addCommentBtn');

      function loadComments() {
        const key = 'comments_article_' + articleIndex;
        const storedComments = localStorage.getItem(key);
        let comments = [];
        if (storedComments) {
          try {
            comments = JSON.parse(storedComments);
          } catch {}
        }
        commentList.innerHTML = '';
        if(comments.length === 0){
          commentList.innerHTML = '<p>Henüz yorum yok.</p>';
        } else {
          comments.forEach(c => {
            const div = document.createElement('div');
            div.className = 'comment';
            div.textContent = c;
            commentList.appendChild(div);
          });
        }
      }

      function saveComment(comment) {
        const key = 'comments_article_' + articleIndex;
        let comments = [];
        const storedComments = localStorage.getItem(key);
        if (storedComments) {
          try {
            comments = JSON.parse(storedComments);
          } catch {}
        }
        comments.push(comment);
        localStorage.setItem(key, JSON.stringify(comments));
      }

      addCommentBtn.addEventListener('click', () => {
        const comment = commentInput.value.trim();
        if(comment === '') return;
        saveComment(comment);
        commentInput.value = '';
        loadComments();
      });

      loadComments();
    }
  </script>

</body>
</html>
